<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Multi Finance | Simulasi Dinamis</title>
    
    <script src="https://cdn.tailwindcss.com/"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: #f8fafc;
        }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            display: none;
            position: fixed;
            inset: 0;
            z-index: 50;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-overlay.active { display: flex; }
        
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .tenor-btn.active {
            background-color: #065f46; /* emerald-800 */
            color: white;
            border-color: #065f46;
        }
    </style>
</head>
<body class="min-h-screen pb-10">

    <div class="w-full max-w-lg mx-auto bg-white min-h-screen shadow-2xl shadow-emerald-900/10 overflow-hidden flex flex-col">
        <header class="bg-emerald-800 p-8 text-white relative">
            <h1 class="text-2xl font-extrabold tracking-tight">Smart Multi Finance</h1>
            <p class="text-emerald-100/70 text-xs mt-1 font-bold uppercase tracking-widest">Solusi Gadai BPKB Terpercaya</p>
        </header>

        <main class="p-6 flex-1">
            <div class="bg-emerald-50 rounded-3xl p-6 mb-8 border border-emerald-100 shadow-sm">
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-2 bg-emerald-600 rounded-lg text-white">
                        <i data-lucide="calculator" class="w-5 h-5"></i>
                    </div>
                    <h2 class="font-bold text-emerald-900">Simulasi Pinjaman</h2>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="text-[10px] font-bold text-emerald-700 uppercase tracking-widest block mb-2 ml-1">Jenis Kendaraan</label>
                        <div class="relative">
                            <select id="main-vehicle-type" onchange="updateTenorOptions()" 
                                class="w-full p-4 bg-white border-2 border-emerald-100 rounded-2xl focus:border-emerald-600 outline-none font-bold text-emerald-900 appearance-none shadow-sm cursor-pointer">
                                <option value="Motor">BPKB Motor</option>
                                <option value="Mobil" selected>BPKB Mobil</option>
                            </select>
                            <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-emerald-600">
                                <i data-lucide="chevron-down" class="w-5 h-5"></i>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="text-[10px] font-bold text-emerald-700 uppercase tracking-widest block mb-2 ml-1">Masukan Plafon Pinjaman (Rp)</label>
                        <div class="relative group">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 font-bold text-emerald-800 text-lg">Rp</span>
                            <input type="text" id="amount-input" value="10.000.000"
                                class="w-full pl-12 pr-4 py-4 bg-white border-2 border-emerald-100 rounded-2xl focus:border-emerald-600 outline-none font-black text-emerald-900 text-xl transition-all shadow-sm"
                                placeholder="Contoh: 10.000.000"
                                oninput="handleAmountChange(this)">
                        </div>
                    </div>

                    <div>
                        <span class="text-[10px] font-bold text-emerald-700 uppercase tracking-widest mb-2 block ml-1">Jangka Waktu (Bulan)</span>
                        <div class="grid grid-cols-4 gap-2" id="tenor-container"></div>
                    </div>
                </div>

                <div class="mt-8 bg-white rounded-2xl p-5 shadow-sm border border-emerald-100 text-center">
                    <p class="text-slate-500 text-xs font-medium mb-1 uppercase tracking-wider">Estimasi Angsuran / Bulan</p>
                    <h3 id="monthly-installment" class="text-3xl font-black text-emerald-800">Rp 0</h3>
                </div>

                <p class="mt-6 text-[13px] text-slate-700 leading-relaxed text-center font-bold italic">
                    PERHATIAN : hitungan ini hanya simulasi, nilai angsuran dan pencairan bisa lebih rendah atau lebih tinggi berdasarkan hasil survey, data asset dan data lainnya. untuk hitungan pasti kendaraan anda silahkan isi data dibawah.
                </p>
            </div>

            <button onclick="openLeadModal()" class="w-full bg-emerald-800 hover:bg-emerald-900 text-white rounded-2xl py-5 px-6 flex flex-col items-center transition-all active:scale-95 shadow-xl shadow-emerald-900/20">
                <span class="text-[10px] font-bold text-emerald-200 uppercase tracking-widest mb-1">Dapatkan hitungan resmi & pencairan</span>
                <div class="flex items-center gap-2">
                    <i data-lucide="search" class="w-5 h-5"></i>
                    <span class="text-lg font-bold">Cek nilai pencairan kendaraanmu sekarang</span>
                </div>
            </button>
        </main>
    </div>

    <div id="lead-modal" class="modal-overlay">
        <div class="bg-white w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-extrabold text-slate-800">Detail Kendaraan</h3>
                <button onclick="closeLeadModal()" class="p-2 bg-slate-100 rounded-full text-slate-500">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="space-y-4">
                <div id="summary-info" class="p-3 bg-emerald-50 rounded-xl mb-4 border border-emerald-100"></div>
                
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1 ml-1">Nama Mitra/Agent</label>
                    <input type="text" id="mitra-name" placeholder="Nama Agent Terdaftar" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-emerald-600 outline-none font-semibold text-emerald-700" readonly>
                </div>

                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1 ml-1">Nama Calon Debitur</label>
                    <input type="text" id="debitur-name" placeholder="Nama sesuai KTP" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-emerald-600 outline-none font-semibold">
                </div>

                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1 ml-1">Merek & Tipe</label>
                    <input type="text" id="vehicle-model" placeholder="Contoh: Honda Vario 150" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-emerald-600 outline-none font-semibold">
                </div>

                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest block mb-1 ml-1">Tahun Kendaraan</label>
                    <input type="number" id="vehicle-year" placeholder="Tahun (Misal: 2019)" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-xl focus:border-emerald-600 outline-none font-semibold">
                </div>

                <button onclick="submitToWhatsApp()" class="w-full bg-emerald-800 text-white font-bold py-5 rounded-2xl shadow-lg hover:bg-emerald-900 transition-all mt-4 flex items-center justify-center gap-2">
                    <i data-lucide="message-circle" class="w-5 h-5"></i>
                    Lanjut ke WhatsApp
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedTenor = 12;

        // FUNGSI BARU: Ambil Nama Mitra dari URL
        function getMitraFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('mitra') || "";
        }

        function formatNumber(n) {
            return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function cleanNumber(s) {
            return parseInt(s.replace(/\./g, "")) || 0;
        }

        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }

        function updateTenorOptions() {
            const type = document.getElementById('main-vehicle-type').value;
            const container = document.getElementById('tenor-container');
            const tenors = type === "Motor" ? [6, 12, 18, 24] : [12, 24, 36, 48];
            selectedTenor = tenors[1];
            container.innerHTML = '';
            tenors.forEach(t => {
                const btn = document.createElement('button');
                btn.innerText = t;
                btn.className = `tenor-btn py-3 rounded-xl border-2 border-emerald-100 bg-white font-bold text-slate-600 transition-all hover:border-emerald-500 ${t === selectedTenor ? 'active' : ''}`;
                btn.onclick = () => setTenor(t, btn);
                container.appendChild(btn);
            });
            calculateSimulation();
        }

        function setTenor(val, el) {
            selectedTenor = val;
            document.querySelectorAll('.tenor-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            calculateSimulation();
        }

        function handleAmountChange(input) {
            let cleanValue = cleanNumber(input.value);
            if (cleanValue > 1000000000) cleanValue = 1000000000;
            input.value = formatNumber(cleanValue.toString());
            calculateSimulation();
        }

        function calculateSimulation() {
            const amount = cleanNumber(document.getElementById('amount-input').value);
            const type = document.getElementById('main-vehicle-type').value;
            const interestRate = 0.01; 
            const totalPayment = amount + (amount * interestRate * selectedTenor);
            const selisih = (type === "Mobil") ? 350000 : 250000;
            const monthly = selectedTenor > 0 ? Math.round(totalPayment / selectedTenor) + selisih : 0;
            document.getElementById('monthly-installment').innerText = formatRupiah(monthly);
        }

        function openLeadModal() {
            const amount = cleanNumber(document.getElementById('amount-input').value);
            if (amount < 2000000) {
                alert("Minimal pengajuan pinjaman adalah Rp 2.000.000");
                return;
            }
            const type = document.getElementById('main-vehicle-type').value;
            const installment = document.getElementById('monthly-installment').innerText;
            document.getElementById('summary-info').innerHTML = `
                <div class="text-[10px] text-emerald-600 font-bold uppercase tracking-wider">Estimasi Terpilih</div>
                <div class="text-sm font-bold text-emerald-900">${type} - Rp ${document.getElementById('amount-input').value} / ${selectedTenor} Bln</div>
                <div class="text-xs text-slate-500">${installment} / bln</div>
            `;
            document.getElementById('lead-modal').classList.add('active');
        }

        function closeLeadModal() {
            document.getElementById('lead-modal').classList.remove('active');
        }

        function submitToWhatsApp() {
            const mitra = document.getElementById('mitra-name').value;
            const debitur = document.getElementById('debitur-name').value.trim();
            const model = document.getElementById('vehicle-model').value.trim();
            const year = document.getElementById('vehicle-year').value.trim();
            const type = document.getElementById('main-vehicle-type').value;
            const amountStr = document.getElementById('amount-input').value;
            const installmentStr = document.getElementById('monthly-installment').innerText;

            if(!debitur || !model || !year) {
                alert("Harap lengkapi data nasabah.");
                return;
            }

            const message = `Halo Smart Finance Tolong Hitungkan Simulasi dari:,\n\n` +
                            `*DATA MITRA PENGIRIM*:\n` +
                            `• Nama Mitra: ${mitra || 'Umum'}\n\n` +
                            `*PENGAJUAN NASABAH*:\n` +
                            `• Nama Debitur: ${debitur}\n` +
                            `• Unit: ${type} ${model} ${year}\n` +
                            `• Plafon: Rp ${amountStr}\n` +
                            `• Tenor: ${selectedTenor} Bulan\n` +
                            `• Angsuran: ${installmentStr}\n\n` +
                            `Mohon dihitungkan segera. Terima kasih.`;

            const waUrl = `https://api.whatsapp.com/send?phone=6281315574375&text=${encodeURIComponent(message)}`;
            window.open(waUrl, '_blank');
        }

        window.onload = () => {
            lucide.createIcons();
            updateTenorOptions();
            // Isi otomatis nama mitra
            document.getElementById('mitra-name').value = getMitraFromURL();
        };
    </script>
</body>
</html>
