<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrasi Mitra - Smart Finance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // Cek jika sudah pernah terdaftar
        if (localStorage.getItem("isRegisteredSmartFinance") === "true") {
            window.location.href = "simulasi.html";
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #fff7ed; 
            background-image: radial-gradient(#ffedd5 1px, transparent 1px);
            background-size: 20px 20px;
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center; padding: 1.5rem;
        }
        .card-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid #fed7aa;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05);
        }
        .input-field { border: 1.5px solid #e2e8f0; transition: all 0.2s; }
        .input-field:focus { border-color: #f26522; box-shadow: 0 0 0 4px rgba(242, 101, 34, 0.1); outline: none; }
        .btn-primary { background: linear-gradient(135deg, #f26522 0%, #c2410c 100%); }
        .loader { width: 18px; height: 18px; border: 2px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="fixed top-8 left-1/2 -translate-x-1/2 md:left-10 md:translate-x-0 bg-white/80 backdrop-blur px-6 py-3 rounded-2xl border border-orange-100 shadow-sm z-50">
        <span class="block text-sm font-black text-slate-800 tracking-tight leading-none mb-1">SMART FINANCE</span>
        <span class="text-[10px] text-orange-600 font-bold uppercase tracking-[0.2em]">Partner Portal</span>
    </div>

    <div class="card-container w-full max-w-md rounded-[2.5rem] overflow-hidden">
        <div class="h-32 bg-orange-600 flex items-center justify-center text-white">
            <h1 class="text-xl font-bold tracking-wide uppercase">Registrasi Mitra</h1>
        </div>

        <div class="p-8 md:p-10">
            <div id="step-1">
                <p class="text-slate-500 text-sm mb-8 text-center">Lengkapi data diri pendaftaran Anda.</p>
                <form id="form-step-1" class="space-y-6">
                    <div class="space-y-1.5">
                        <label class="text-xs font-bold text-slate-700 uppercase">Nama Sesuai KTP</label>
                        <input type="text" id="reg-nama" name="nama" required placeholder="Nama Lengkap" class="input-field w-full px-5 py-3.5 rounded-2xl bg-slate-50/50">
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-xs font-bold text-slate-700 uppercase">No HP/WhatsApp</label>
                        <input type="tel" id="reg-kontak" name="kontak" required placeholder="08xxxxxxxxxx" class="input-field w-full px-5 py-3.5 rounded-2xl bg-slate-50/50">
                    </div>
                    <div class="space-y-1.5">
                        <label class="text-xs font-bold text-slate-700 uppercase">Nama Upline (MCS)</label>
                        <input type="text" id="reg-upline" name="upline" required placeholder="Nama Pengajak" class="input-field w-full px-5 py-3.5 rounded-2xl bg-slate-50/50">
                    </div>
                    <button type="submit" class="btn-primary w-full text-white font-bold py-4 rounded-2xl text-lg uppercase shadow-lg shadow-orange-200">Lanjut</button>
                </form>
            </div>

            <div id="step-2" class="hidden text-center py-4 space-y-6">
                <div class="w-16 h-16 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mx-auto mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-slate-800">Hampir Selesai!</h2>
                    <p class="text-slate-500 text-sm mt-2 px-4">Terakhir, masukkan profesi atau jenis usaha Anda saat ini.</p>
                </div>
                <div class="bg-orange-50 p-6 rounded-[2rem] border-2 border-dashed border-orange-200">
                    <label class="block text-[10px] font-black text-orange-700 uppercase tracking-widest mb-3">JENIS USAHA / PROFESI</label>
                    <input type="text" id="reg-usaha" name="usaha" placeholder="Contoh: Toko Kelontong" class="w-full bg-white border-2 border-orange-100 px-4 py-4 rounded-xl text-center text-xl font-bold text-orange-900 focus:border-orange-500 outline-none">
                    <p id="error-usaha" class="text-red-500 text-[10px] mt-2 font-bold hidden uppercase">Wajib diisi!</p>
                </div>
                <button id="final-submit-btn" class="w-full bg-slate-900 text-white font-bold py-5 rounded-2xl flex items-center justify-center gap-2 uppercase tracking-wide">
                    Selesaikan Pendaftaran
                </button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx3L-Cf8P7FzmMSYsw1J5_epDl7uFtIMttBK2z0lQ2oy3KkVtixzBgVAqcpEEVCzsjs/exec';

        const step1 = document.getElementById('step-1');
        const step2 = document.getElementById('step-2');
        const formStep1 = document.getElementById('form-step-1');
        const finalBtn = document.getElementById('final-submit-btn');

        // Logic Step 1: Simpan Sementara
        formStep1.addEventListener('submit', e => {
            e.preventDefault();
            step1.classList.add('hidden');
            step2.classList.remove('hidden');
        });

        // Logic Final: Ambil semua data & Kirim ke Google Sheet
        finalBtn.addEventListener('click', () => {
            const usaha = document.getElementById('reg-usaha').value.trim();
            const nama = document.getElementById('reg-nama').value;
            const kontak = document.getElementById('reg-kontak').value;
            const upline = document.getElementById('reg-upline').value;

            if (!usaha) {
                document.getElementById('error-usaha').classList.remove('hidden');
                return;
            }

            finalBtn.disabled = true;
            finalBtn.innerHTML = `<span class="loader"></span> <span>Menyimpan...</span>`;

            // Membuat FormData Gabungan
            const formData = new FormData();
            formData.append('nama', nama);
            formData.append('kontak', kontak);
            formData.append('upline', upline);
            formData.append('usaha', usaha); // Ini akan masuk ke kolom 'usaha' di Sheet

            fetch(SCRIPT_URL, { method: 'POST', body: formData })
            .then(response => {
                // SIMPAN STATUS & DATA KE LOCALSTORAGE (Untuk Simulasi)
                localStorage.setItem('isRegisteredSmartFinance', 'true');
                localStorage.setItem('mitra_name', nama);
                localStorage.setItem('mitra_usaha', usaha);
                
                // Pindah ke simulasi
                window.location.href = "simulasi.html";
            })
            .catch(error => {
                alert("Koneksi terputus. Silakan coba lagi.");
                finalBtn.disabled = false;
                finalBtn.innerHTML = "Selesaikan Pendaftaran";
            });
        });
    </script>
</body>
</html>